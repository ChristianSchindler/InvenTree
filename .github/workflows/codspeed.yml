name: codspeed-benchmarks

on:
  push:
    branches:
      - "master"
      - "codspeed/*"
      - "codspeed"
  pull_request:
  workflow_dispatch:

jobs:
  benchmarks:
    runs-on: ubuntu-latest
    env:
      INVENTREE_DB_NAME: ./inventree.sqlite
      INVENTREE_STATIC_ROOT: ./static
      INVENTREE_MEDIA_ROOT: ./media
      INVENTREE_BACKUP_DIR: ./backups
      INVENTREE_DB_ENGINE: sqlite3
      INVENTREE_DEBUG: info
      INVENTREE_PLUGINS_ENABLED: false

    steps:
      - uses: actions/checkout@v3
      - name: Environment Setup
        uses: ./.github/actions/setup
        with:
          apt-dependency: gettext poppler-utils
          dev-install: true
          install: true
      - name: Run benchmarks
        uses: CodSpeedHQ/action@v2
        with:
          run: |
            invoke update
            pytest InvenTree/ --codspeed
